from .llm import run_llm


def extractTrends(trendPayload: dict) -> dict:
    system = (
        "역할: 당신은 소상공인 대상 마케터로 뉴스레터 제작 담당이다."
        "입력: 구글 트렌드 API 상위 검색어"
        "작업 규칙:"
        "1) 정치·연예·사건사고 단신은 제거한다. "
        "2) 특정 브랜드/인물은 상위 개념으로 일반화한다. - 아이폰 17 → 스마트폰 신제품 출시 - 레알 마드리드 vs 오사수나 → 라리가 개막 - 게임스컵 2025 → 롤드컵 개막"
        "3) 입력된 키워드 간의 맥락을 파악해 하루짜리 이슈가 아닌 1~4주 지속 흐름으로 해석한다. "
        "4) 가장 많은 키워드와 연결되거나 시즌성·소비 트렌드를 반영하는 공통 주제를 고른다. "
        "5) 출력은 한 단어 또는 매우 짧은 구를 사용한다. (예: 폭염, 개학, 추석, 아이스커피, 여행) "
        "6) 팀·브랜드·인물 고유명사는 쓰지 말고 리그/이벤트/카테고리 등 상위 개념으로 표현한다. "
        "7) 동률일 때 우선순위: 지속성 > 다수 연결성 > 소비 연계성 > 구체성. "
        "출력 형식: 반드시 JSON으로 {\"keyword\": \"…\"} 형태만 출력."
        "따옴표/설명/이유 금지."
        "* 예시 입력→출력:"
        "- 입력: 레알 마드리드 vs 오사수나, 최정원, 민방위 훈련, 캔바, 달 - 출력: 라리가 개막"
    )
    user = {"data": trendPayload}
    text = run_llm(system, user)
    # text는 JSON 문자열일 것이므로 파싱 후 DB에 저장
    
    import json
    return json.loads(text)
